
-- унаследованный @definitionTypes - это информация об атомах, видимых в where и value
-- данного Definition
-- синтезированный @definitionTypes - это информация о текущем атоме, передаваемая наверх
-- в узел Program для агрегации и последующей передачи в узел @Definition.where : Expression
--

ATTR Definition [ definitionTypes : {M.Map String T} | | definitionType : T ]

-- Узел Program просто пересылает эти атрибуты - копирует и агрегирует соответственно

ATTR Program [ | definitionTypes : {M.Map String T} | ]

ATTR Expression ExpressionList [ definitionTypes : {M.Map String T} | | ]

SEM Program
	| Cons
		tl.definitionTypes = M.insert @hd.name @hd.definitionType @lhs.definitionTypes

SEM Definition
	| Definition
		-- НЕУКЛЮЖЕСТЬ
		-- унаследованный @definitionTypes "спускается" Definition -> Program -> Value
		-- но из-за того, что у нас where, а не let-in, этому спуску соответствуют
		-- "нырки" в следующих двух строках:
		where.definitionTypes = @lhs.definitionTypes
		value.definitionTypes = @where.definitionTypes

		--  собрали информацию от выводильщика и отправили всё так же "вниз"
		--	по пути  Definition -> Program -> Value, но из-за извращенного
		--	where получается сначала "наверх" в Program, затем транзитом
		-- через следующий Definition в Value
		lhs.definitionType = @loc.definitionType
